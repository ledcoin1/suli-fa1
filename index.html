<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <title>Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body style="font-family:sans-serif; background:#111; color:#fff; padding:20px">

  <h2>Сәлем, ойыншы!</h2>
  <p><b>ID:</b> <span id="uid">...</span></p>
  <p><b>Баланс:</b> <span id="balance">0</span></p>

  <button onclick="loadBalance()">Баланс жаңарту</button>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // Telegram ID алу
    const user = tg.initDataUnsafe?.user;
    let userId = "guest";

    if (user && user.id) {
      userId = user.id;
    }

    document.getElementById("uid").innerText = userId;

    const SERVER = "https://sulifaaaaaa3server.onrender.com";

    async function loadBalance() {
      try {
        const res = await fetch(`${SERVER}/balance/${userId}`);
        const data = await res.json();
        document.getElementById("balance").innerText = data.balance;
      } catch (e) {
        alert("Серверге қосылмады");
      }
    }

    // автомат жүктеу
    loadBalance();
  </script>

</body>
</html>
