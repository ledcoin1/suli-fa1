<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <title>Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body style="font-family:sans-serif; background:#111; color:#fff; padding:20px">

  <h2>–°”ô–ª–µ–º, –æ–π—ã–Ω—à—ã!</h2>
  <p><b>ID:</b> <span id="uid">...</span></p>
  <p><b>–ë–∞–ª–∞–Ω—Å:</b> <span id="balance">0</span></p>

  <button onclick="loadBalance()">–ë–∞–ª–∞–Ω—Å –∂–∞“£–∞—Ä—Ç—É</button>

  <h2>ü™ô –ë–∞–ª–∞–Ω—Å: <span id="balance">0</span></h2>

<input type="number" id="bet" placeholder="–°—Ç–∞–≤–∫–∞ —Å–æ–º–∞—Å—ã">

<br><br>

<button onclick="play('rock')">‚úä –¢–∞—Å</button>
<button onclick="play('paper')">‚úã “ö–∞“ì–∞–∑</button>
<button onclick="play('scissors')">‚úåÔ∏è “ö–∞–π—à—ã</button>

<p id="result"></p>


  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // Telegram ID –∞–ª—É
    const user = tg.initDataUnsafe?.user;
    let userId = "guest";

    if (user && user.id) {
      userId = user.id;
    }

    document.getElementById("uid").innerText = userId;

    const SERVER = "https://sulifaaaaaa3server.onrender.com";

    async function loadBalance() {
      try {
        const res = await fetch(`${SERVER}/balance/${userId}`);
        const data = await res.json();
        document.getElementById("balance").innerText = data.balance;
      } catch (e) {
        alert("–°–µ—Ä–≤–µ—Ä–≥–µ “õ–æ—Å—ã–ª–º–∞–¥—ã");
      }
    }

    // –∞–≤—Ç–æ–º–∞—Ç –∂“Ø–∫—Ç–µ—É
    loadBalance();

    const userId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id || "test_user";
const API = "https://sulifaaaaaa3server.onrender.com";

async function loadBalance() {
  const res = await fetch(`${API}/balance/${userId}`);
  const data = await res.json();
  document.getElementById("balance").innerText = data.balance;
}

loadBalance();

async function play(choice) {
  const bet = Number(document.getElementById("bet").value);

  if (!bet || bet <= 0) {
    alert("–°—Ç–∞–≤–∫–∞ –µ–Ω–≥—ñ–∑!");
    return;
  }

  const res = await fetch(`${API}/play`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      id: userId,
      bet: bet,
      choice: choice
    })
  });

  const data = await res.json();

  if (data.error) {
    document.getElementById("result").innerText = data.error;
    return;
  }

  document.getElementById("result").innerHTML = `
    –°–µ–Ω: ${data.yourChoice} <br>
    –ë–æ—Ç: ${data.botChoice} <br>
    –ù”ô—Ç–∏–∂–µ: ${data.result}
  `;

  document.getElementById("balance").innerText = data.newBalance;
}

  </script>

</body>
</html>
